#* @vtlvariable name="protocol" type="java.lang.String" *#
<html>
	<head>
		<title>$action.getActionName($action.getClass().getName())</title>
        <content tag="selectedWebItem">mailservers</content>
        #requireResource("confluence.web.resources:mailserver")
	</head>

	<body>
		#parse ( "/template/includes/actionerrors.vm" )

        #applyDecorator("form-aui")
            <h2>$action.getText("${protocol}.mail.server.details")</h2>

            #if ($action.actionName == "edit")
                #decoratorParam("formName" "doeditmailserver")
                #decoratorParam("submitAction" "doeditmailserver.action")
            #else
                #decoratorParam("formName" "docreatemailserver")
                #decoratorParam("submitAction" "docreatemailserver.action")
            #end

            #decoratorParam("formStyle" "long-label")
            #decoratorParam("editMode" "true")
            #form_xsrfToken()

            #stextfield("label='mail.server.name'" "name='name'" "theme='aui'"
                        "description=$action.getText('mail.server.name.description')"
                        "autofocus=true")
            #if ($protocol == "smtp")
                #stextfield("label='mail.server.from.address'" "name='emailAddress'" "theme='aui'"
                            "description=$action.getText('mail.server.from.address.description')")
                #stextfield("label='mail.server.from.name'" "name='fromName'" "theme='aui'"
                            "description=$action.getText('mail.server.from.name.description')")
                #stextfield("label='mail.server.subject.prefix'" "name='prefix'" "theme='aui'"
                            "description=$action.getText('mail.server.subject.prefix.description')")
            #else
                #stextfield("label='mail.server.to.address'" "name='emailAddress'" "theme='aui'")
            #end
            <h2>$action.getText("mail.server.host")</h2>
            #if ($protocol == "smtp")
                <p>$action.getText("smtp.serverdetails.desc")</p>
            #end

            #stextfield("label='mail.server.host'" "name='hostname'" "theme='aui'"
                        "description=$action.getText('mail.server.host.description')")
            #if ($protocol != 'smtp')
                #sselect("label='mailserver.protocol'" "id=protocol" "name='protocol'" "value=protocol" "list=incomingProtocolList" "listKey=key" "listValue=value" "theme='aui'")
                #shidden("name='token'" "id=token")
            #end
            #stextfield("label='mail.server.port'" "name='port'" "theme='aui'"
                        "description= $action.getText('mail.server.port.description')")
            #if ($protocol != 'smtp')
                #sselect("label='mail.server.authorization'" "name='authorization'" "id=authorization" "list=authorizationList" "listKey=key" "listValue=value" "theme='aui'")
            #end
            #stextfield("label='mail.server.userName'" "name='userName'" "theme='aui'"
                        "description= $action.getText('mail.server.userName.description')")
            #spassword("label='mail.server.password'" "name='password'")

            <p/>

            #if ($protocol == "smtp")
                #scomponent("template='onofflist.vm'" "label='mail.server.tls.required'" "name='tlsRequired'" "theme='aui'"
                            "description= $action.getText('mail.server.tls.required.description')")
                #end

                <p>$action.getText("common.words.or")</p>
                <h4>$action.getText("jndi.location")</h4>
                #stextfield("label='jndi.location'" "name='jndiName'" "theme='aui'"
                            "description= $action.getText('jndi.location.description')")

                #shidden("name='protocol'" "value=protocol")
            #end

            #if ($action.actionName == "edit")
                #shidden("name='id'" "value=id")
            #end

            <div class="buttons-container">
                <div class="buttons">
                    #ssubmit("name='confirm'" "value='submit.name'" "theme='notable'" "cssClass='aui-button aui-button-primary'")
                #if ($protocol != "smtp")
                    #ssubmit("name='authorize'" "value='authorize.name'" "theme='notable'" "cssClass='aui-button'")
                    #ssubmit("name='testConnection'" "value='test.connection.name'" "theme='notable'" "cssClass='aui-button'")
                    <span id="testConnection-spinner" class="button-spinner"></span>
                #end
                    #ssubmit("name='cancel'" "value='cancel.name'" "theme='notable'" "cssClass='aui-button aui-button-link'")
                </div>
            </div>
        #end


    </body>
</html>
