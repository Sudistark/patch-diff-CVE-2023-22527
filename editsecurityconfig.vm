#* @vtlvariable name="action" type="com.atlassian.confluence.admin.actions.SecurityConfigurationAction" *#
<html>
<head>
    <title>$action.getText("title.edit.security.config")</title>
    <content tag="selectedWebItem">securityconfiguration</content>
</head>
<body>
    #requireResource("confluence.web.resources:aui-forms")
    #requireResource("confluence.sections.admin.generalconfig:resources")

    #parse ( "/template/includes/actionerrors.vm" )

    #if($editMode)
        #set($formAction="doeditsecurityconfig.action")
    #else
        #set($formAction="editsecurityconfig.action")
    #end

<form method="POST" class="aui long-label" name="editsecurityconfig" action="$formAction">
    #form_xsrfToken()

    ## Security configurations
    <h2>
        $action.getText("sub.title.security")
        #if(!$editMode)
            <a href="$req.contextPath/admin/editsecurityconfig.action" class="edit-link aui-button">
                <span class="aui-icon aui-icon-small aui-iconfont-edit"></span>
                $action.getText("edit.name")
            </a>
        #end
    </h2>
    <p>$action.getText("sub.title.security.description")</p>

    #set( $externalUserManagementDescription = "$i18n.getText('external.user.management.description') #doc('help.disabling.built-in.user.management' $i18n.getText('more.about.user.management'))")
    #scomponent("label='ext.user.management'" "name='externalUserManagement'"  "value=externalUserManagement" "theme='aui'"  "template='onofflist.vm'" "disabled=!$systemAdmin"
                "description=$externalUserManagementDescription")
    #end

    #scomponent("label='users.addwildcards'" "name='addWildcardsToUserAndGroupSearches'" "value=addWildcardsToUserAndGroupSearches" "theme='aui'" " disabled=!$systemAdmin" "template='onofflist.vm'")
    #end

    #set( $nofollowExternalLinksDescription = "$i18n.getText('hide.external.links.description') #doc('help.managing.external.referrers' $i18n.getText('more.about.external.links'))")
    #scomponent("label='nofollow.external.links'" "name='nofollowExternalLinks'" "value=nofollowExternalLinks" "theme='aui'" "template='onofflist.vm'"
                "description=$nofollowExternalLinksDescription")
    #end

    #scomponent("label='allow.remoteapi.anonymous'" "name='allowRemoteApiAnonymous'" "value=allowRemoteApiAnonymous" "theme='aui'" "template='onofflist.vm'"
                "description=$i18n.getText('remote.api.anonymous.access.description')")
    #end

    #scomponent("label='enable.space.styles'" "name='enableSpaceStyles'" "value=enableSpaceStyles" "theme='aui'" "template='onofflist.vm'" "disabled=!$systemAdmin")
    #end
    #scomponent("label='sys.info.500'" "name='showSystemInfoIn500Page'" "value=showSystemInfoIn500Page" "theme='aui'" "template='onofflist.vm'" "disabled=!$systemAdmin")
    #end
    #sselect("label='email.address.visibility'" "name='emailAddressVisibility'" "list=emailAddressVisibilityTypes" "listKey=key" "listValue=value" "theme='aui'")
    #stextfield("label='rss.max.items'" "name='maxRssItems'" "theme='aui'" "value=maxRssItems" "disabled=!$systemAdmin"
                "shortField=true"
                "description=$i18n.getText('rss.max.items.description')")

    #stextfield("label='rss.max.time'" "name='rssTimeout'" "theme='aui'" "value=rssTimeout" "disabled=!$systemAdmin"
                "shortField=true"
                "inlineText=$i18n.getText('core.dateutils.seconds')"
                "description=$i18n.getText('rss.max.time.description')")

    #stextfield("label='page.render.max.time'" "name='pageTimeout'" "theme='aui'" "value=pageTimeout" "disabled=!$systemAdmin"
                "shortField=true"
                "inlineText=$i18n.getText('core.dateutils.seconds')"
                "description=$i18n.getText('page.render.max.time.description')")

    <fieldset class="group">
        #if (!$editMode || ($editMode && $action.passConfirmationConfigurable))
            <legend><span>$action.getText("login.elevatedsecurity.use.captcha")</span></legend>
            #scomponent("label='enable.name'" "name='enableElevatedSecurityCheck'" "value=enableElevatedSecurityCheck" "theme='aui'" "template='onofflist-include.vm'")
            #end
            #if($editMode && $action.passConfirmationConfigurable)
                #stextfield("id=loginAttemptsThreshold" "label=''" "name='loginAttemptsThreshold'" "value=loginAttemptsThreshold" "theme='aui'"
                            "shortField=true"
                            "inlineText=$action.getText('login.elevatedsecurity.loginAttemptsThreshold.form')")
            #elseif (!$editMode)
                #if (!$action.passConfirmationConfigurable)
                    $action.getText('password.confirmation.disabled')
                #elseif($action.enableElevatedSecurityCheck)
                    <label>
                        #if ($action.enableElevatedSecurityCheck && $action.loginAttemptsThreshold >= 0)
                            #if($action.loginAttemptsThreshold == 0)
                                ($action.getText('login.elevatedsecurity.loginAttemptsThreshold.label.always'))
                            #elseif($action.loginAttemptsThreshold == 1)
                                ($action.getText('login.elevatedsecurity.loginAttemptsThreshold.label.singular'))
                            #else
                                ($action.getText('login.elevatedsecurity.loginAttemptsThreshold.label.plural', [$action.loginAttemptsThreshold]))
                            #end
                        #end
                    </label>
                #end
            #end
        #end
    </fieldset>
    <fieldset class="group">
        #if (!$editMode || ($editMode && $action.passConfirmationConfigurable))
            <legend><span>$action.getText("websudo.enabled")</span></legend>
            #scomponent("label='enable.name'" "name='webSudoEnabled'" "value=webSudoEnabled" "theme='aui'" "template='onofflist-include.vm'")
            #end
            #if($editMode)
                #stextfield("id=webSudoTimeout" "label=''" "name='webSudoTimeout'" "value=webSudoTimeout" "theme='aui'"
                            "shortField=true"
                            "inlineText=$action.getText('websudo.timeout.label.input')")
            #else
                #if (!$action.passConfirmationConfigurable)
                    $action.getText('password.confirmation.disabled')
                #elseif($action.webSudoEnabled)
                    <label>
                        #if ($action.webSudoEnabled && $action.webSudoTimeout >= 0)
                            #if($action.loginAttemptsThreshold == 1)
                                ($action.getText('websudo.timeout.label.singular'))
                            #else
                                ($action.getText('websudo.timeout.label.plural', [$action.webSudoTimeout]))
                            #end
                        #end
                    </label>
                #end
            #end
         #end
        <div class="description description-textbox">
            $i18n.getText('secure.admin.sessions.description')
         #doc("help.secure.admin.sessions" "$i18n.getText('more.about.secure.admin.sessions')")
        </div>
    </fieldset>

    #sradio("label='attachment.security.level.label'" "list=attachmentSecurityLevels" "name='attachmentSecurityLevel'" "value=attachmentSecurityLevel" "theme='aui'" "template='radiolist.vm'" "listKey=value" "listValue=key" "disabled=!$systemAdmin"
            "displayValue=$attachmentSecurityLevelDisplay")

    <h2 id="xsrf">
        $action.getText("sub.title.xsrf")
        #if(!$editMode)
            <a href="$req.contextPath/admin/editsecurityconfig.action#xsrf" class="edit-link aui-button">
                <span class="aui-icon aui-icon-small aui-iconfont-edit"></span>
                $action.getText("edit.name")
            </a>
        #end
    </h2>
    <p>$action.getText("sub.title.xsrf.description")</p>
    #scomponent("label='xsrf.addComments'" "name='xsrfAddComments'" "value=xsrfAddComments" "theme='aui'" "template='onofflist.vm'" "disabled=!$systemAdmin"
                "description=$i18n.getText('xsrf.addComments.description')")
    #end

    <div class="hidden parameters">
        <input type="hidden" id="editMode" value="$editMode">
    </div>

    ## Buttons
    #if($editMode)
        #ssubmit("theme='aui'"
                 "submitValue=$action.getText('update.name')"
                 "cancelValue=$action.getText('cancel.name')")
    #end
</form>

    #parse("/breadcrumbs.vm")
</body>
</html>
