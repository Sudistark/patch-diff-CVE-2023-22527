#* @vtlvariable name="action" type="com.atlassian.confluence.setup.actions.SetupClusterAction" *#
<html>
    <head>
        $webResourceManager.requireResourcesForContext("setup.cluster")
        #requireResource("com.atlassian.auiplugin:aui-spinner")
        #requireResource("com.atlassian.auiplugin:aui-button")

        #set ($isServertoDataCenterMigration = $action.isServerToDataCenterMigration())

        #if($isServertoDataCenterMigration)
            <title>$action.getText("title.setup.cluster")</title>
        #else
            <title>$action.getText("title.setup.deployment")</title>
        #end
    </head>
    <body>
        #parse ("/setup/analytics-data.vm")
        #parse ("/template/includes/actionerrors.vm")
        #parse ("/setup/setup-button.vm")

        #set ($clusterableInterfaces = $action.clusterableInterfaces)
        #set ($isSingleNodeChecked = $action.setupClusterType == "skipCluster" || $htmlUtil.htmlEncode($action.clusterName) == "")

        #if(!$isServertoDataCenterMigration)

            <div class="field-group clustering-option-header">
                <div class="setup-section-subtitle">
                    $action.getText('cluster.setup.page.description')
                </div>
            </div>

            <div class="radio clustering-option">
                <input class="radio" type="radio" name="isClusteringEnabled" value="true" id="clusteringDisabled" #if($isSingleNodeChecked) checked #end>
                <label for="clusteringDisabled">$action.getText("cluster.setup.radio.singlenode")</label>
            </div>
            <div class="radio clustering-option">
                <input class="radio" type="radio" name="isClusteringEnabled" value="false" id="clusteringEnabled" #if(!$isSingleNodeChecked) checked #end>
                <label for="clusteringEnabled">$action.getText("cluster.setup.radio.cluster")</label>
            </div>
        #end

        <form method="POST" name="clusterform" action="setupcluster.action" class="aui top-label" #if(!$isServertoDataCenterMigration && $isSingleNodeChecked) style="display: none" #end>
            #form_xsrfToken()
            <fieldset>

                <div class="field-group">
                    #if(!$isServertoDataCenterMigration)
                        <div class="field-group clustering-option-header">
                            <h3>$action.getText('cluster.setup.page.subtitle')</h3>
                        </div>
                    #end
                    <div class="setup-section-subtitle">
                        $action.getText("description.setup.cluster")
                    </div>
                </div>

                <div class="field-group top-label">
                    <label for="clusterName">
                        $action.getText('cluster.setup.name.label')
                        <span class="aui-icon icon-required">required</span>
                    </label>
                    <input name="clusterName" id="clusterName" type="text" class="text" value="$htmlUtil.htmlEncode($action.clusterName)">
                    <div class="error hidden">$action.getText("required.field")</div>
                    <div class="description">
                        $action.getText("cluster.setup.name.description")
                    </div>
                </div>

                <div class="field-group">
                    <label for="clusterHome">
                        $action.getText('cluster.setup.home.label')
                        <span class="aui-icon icon-required">required</span>
                    </label>
                    <input name="clusterHome" id="clusterHome" type="text" class="text" value="$htmlUtil.htmlEncode($action.clusterHome)"/>
                    <div class="error hidden">$action.getText("required.field")</div>
                    <div class="description">
                        $action.getText("cluster.setup.home.description")
                    </div>
                </div>


                #if ($clusterableInterfaces.size() == 1)
                    #applyDecorator("warning")
                        $action.getText("cluster.only.one.network.interface.warning")
                    #end
                #end

                <div class="field-group network-interface-section">
                    <h3>$action.getText("cluster.interface.label")</h3>
                    <div class="setup-section-subtitle">$action.getText("cluster.interface.description")</div>
                    <table class="aui aui-table-interactive network-interface">
                        <thead>
                            <tr>
                                <th id="clustaddr_choser">&nbsp;</th>
                                <th id="clustaddr_interface">$action.getText("name.word")</th>
                                <th id="clustaddr_ipv6">$action.getText("ipv6.word")</th>
                                <th id="clustaddr_ipv4">$action.getText("ipv4.word")</th>
                            </tr>
                        </thead>
                        <tbody>
                            #foreach ($iface in $clusterableInterfaces)
                            <tr>
                                <td headers="clustaddr_choser"><input type="radio" name="networkInterface" value="$iface.name" #if ($iface.current) checked="true" #end /></td>
                                <td headers="clustaddr_interface">$iface.name</td>
                                <td headers="clustaddr_ipv6">
                                #if ($iface.ipv6Addresses.size() > 0)
                                    <ul>
                                    #foreach ($addr in $iface.ipv6Addresses)
                                        <li>$addr.hostAddress</li>
                                    #end
                                    </ul>
                                #end
                                </td>
                                <td headers="clustaddr_ipv4">
                                #if ($iface.ipv4Addresses.size() > 0)
                                    <ul>
                                    #foreach ($addr in $iface.ipv4Addresses)
                                        <li>$addr.hostAddress</li>
                                    #end
                                    </ul>
                                #end
                                </td>
                            </tr>
                            #end
                        </tbody>
                    </table>

                    <div class="description">
                        $action.getText("cluster.setup.choose.network.interface.description")
                    </div>
                </div>

                <div class="field-group">
                    <h3>$action.getText("cluster.setup.join.config.label")</h3>
                    <div class="setup-section-subtitle join-config-section">$action.getText("cluster.setup.join.config.description")</div>
                    <div class="radio join-config-radio">
                        <input class="radio" type="radio" name="joinMethod" value="multicast" id="useMulticast" #if($action.isMulticast()) checked #end>
                        <label for="useMulticast">$action.getText('cluster.setup.join.config.multicast')</label>
                    </div>
                    <div class="radio join-config-radio">
                        <input class="radio" type="radio" name="joinMethod" value="tcp_ip" id="useTcpIp" #if($action.isTcpIp()) checked #end>
                        <label for="useTcpIp">$action.getText('cluster.setup.join.config.tcpip')</label>
                    </div>
                    <div class="radio join-config-radio">
                        <input class="radio" type="radio" name="joinMethod" value="aws" id="useAws" #if($action.isAws()) checked #end>
                        <label for="useAws">$action.getText('cluster.setup.join.config.aws')</label>
                    </div>
                </div>

                <div id="cluster-multicast-group" #if(!$action.isMulticast()) style="display:none;" #end>
                    <div class="field-group">
                        <label for="clusterAddressString">$action.getText('cluster.setup.address.label')</label>
                        <div id="cluster-address-control">
                            <input id="cluster-auto-address" type="checkbox" name="generateClusterAddress" value="auto" #if ($action.isGenerateAddress())checked #end>$action.getText('cluster.setup.generate.address')
                            <input id="cluster-auto-address-hidden" type="checkbox" name="generateClusterAddressSubmitted" value="submitted" checked>
                        </div>
                    </div>
                    <div id="cluster-address-field" #if ($action.isGenerateAddress())style="display:none;" #end>
                        <div class="field-group">
                            <input name="clusterAddressString" id="clusterAddressString" type="text" class="text" value="$htmlUtil.htmlEncode($action.clusterAddressString)">
                            <div class="description">
                                $action.getText("cluster.setup.address.description")
                            </div>
                        </div>
                    </div>
                </div>

                <div id="cluster-tcpip-group" #if(!$action.isTcpIp()) style="display:none;" #end>
                    <div class="field-group">
                        <label for="clusterAddressString">$action.getText('cluster.setup.peers.label')</label>
                        <div id="cluster-peers-field">
                            <input name="clusterPeersString" id="clusterPeersString" type="text" class="text" value="$htmlUtil.htmlEncode($action.clusterPeersString)">
                            <div class="description">
                                $action.getText("cluster.setup.peers.description")
                            </div>
                        </div>
                    </div>
                </div>

                <div id="cluster-aws-group" #if(!$action.isAws()) style="display:none;" #end>
                    <div class="field-group">
                        <label>$action.getText("cluster.setup.join.config.aws.authmethod.label")</label>
                        <div class="radio join-config-radio">
                            <input class="radio" type="radio" name="awsAuthMethod" value="iamrole" id="useIamRole" #if($action.isAwsIamRoleAuth()) checked #end>
                            <label for="useIamRole">$action.getText('cluster.setup.join.config.aws.useiamrole')</label>
                        </div>
                        <div class="radio join-config-radio">
                            <input class="radio" type="radio" name="awsAuthMethod" value="secretkey" id="useSecretKey" #if($action.isAwsSecretKeyAuth()) checked #end>
                            <label for="useSecretKey">$action.getText('cluster.setup.join.config.aws.usesecretkey')</label>
                        </div>
                    </div>

                    <div id="cluster-aws-iamrole" #if(!$action.isAwsIamRoleAuth()) style="display:none;" #end>
                        <div class="field-group">
                            <label for="iamRole">$action.getText('cluster.setup.join.config.aws.iamrole')</label>
                            <div id="cluster-iamrole-field">
                                <input name="iamRole" id="iamRole" type="text" class="text" value="$htmlUtil.htmlEncode($action.iamRole)">
                            </div>
                        </div>
                    </div>

                    <div id="cluster-aws-secretkey" #if(!$action.isAwsSecretKeyAuth()) style="display:none;" #end>
                        <div class="field-group">
                            <label for="accessKey">$action.getText('cluster.setup.join.config.aws.accesskey')</label>
                            <div id="cluster-accesskey-field">
                                <input name="accessKey" id="accessKey" type="text" class="text" value="$htmlUtil.htmlEncode($action.accessKey)">
                            </div>
                        </div>
                        <div class="field-group">
                            <label for="secretKey">$action.getText('cluster.setup.join.config.aws.secretkey')</label>
                            <div id="cluster-secretkey-field">
                                <input name="secretKey" id="secretKey" type="password" class="password" value="$htmlUtil.htmlEncode($action.secretKey)">
                            </div>
                        </div>
                    </div>

                    <div class="field-group">
                        <label for="region">$action.getText('cluster.setup.join.config.aws.region')</label>
                        <div>
                            <input name="region" id="region" type="text" class="text" value="$htmlUtil.htmlEncode($action.region)">
                        </div>
                    </div>
                    <div class="field-group">
                        <label for="hostHeader">$action.getText('cluster.setup.join.config.aws.hostheader')</label>
                        <div>
                            <input name="hostHeader" id="hostHeader" type="text" class="text" value="$htmlUtil.htmlEncode($action.region)">
                        </div>
                    </div>
                    <div class="field-group">
                        <label for="securityGroupName">$action.getText('cluster.setup.join.config.aws.securitygroupname')</label>
                        <div>
                            <input name="securityGroupName" id="securityGroupName" type="text" class="text" value="$htmlUtil.htmlEncode($action.securityGroupName)">
                        </div>
                    </div>
                    <div class="field-group">
                        <label for="tagKey">$action.getText('cluster.setup.join.config.aws.tagkey')</label>
                        <div>
                            <input name="tagKey" id="tagKey" type="text" class="text" value="$htmlUtil.htmlEncode($action.tagKey)">
                        </div>
                    </div>
                    <div class="field-group">
                        <label for="tagValue">$action.getText('cluster.setup.join.config.aws.tagvalue')</label>
                        <div>
                            <input name="tagValue" id="tagValue" type="text" class="text" value="$htmlUtil.htmlEncode($action.tagValue)">
                        </div>
                    </div>
                </div>
            </fieldset>
            <div class="buttons-container">
                <div class="buttons">
                    <input name="newCluster" type="hidden" id="newCluster" value="$action.getText('new.cluster')">
                    <button class="aui-button aui-button-primary setup-button start-setup-button" name="newCluster">$action.getText('new.cluster')</button>
                </div>
            </div>
        </form>
        #if(!$isServertoDataCenterMigration || $action.setupClusterType == "newCluster")
            <button id="skip-button" class="aui-button aui-button-primary setup-back-button" #if(!$isSingleNodeChecked) style="display: none" #end>$action.getText('setup.next')</button>
        #end
    </body>
</html>
