<html>
	<head>
        <title>$htmlUtil.htmlEncode($pageTitle)</title>
        #requireResource("confluence.web.resources:aui-forms")
	</head>

    #applyDecorator("root")
        #decoratorParam("context" "profile")
        #decoratorParam("mode" "edit-profile-single")
        #decoratorParam("helper" $action.helper)
        #decoratorParam("infopanel-width" "200px")

    <body>
        #if($confirmPassOnEmailChange)
            #requireResource("confluence.web.resources:edit-user-profile")
            #parse("/users/password-dialog-templates.vm")
        #end

        <div class="page-item profile-info">
            #applyDecorator("form-aui")
                #decoratorParam("formName" "editmyprofileform")
                #decoratorParam("formId" "editmyprofileform")
                #decoratorParam("submitAction"  "$req.contextPath/users/doeditmyprofile.action")
                #decoratorParam("editAction" "$req.contextPath/users/editmyprofile.action")
                #decoratorParam("editMode" "$editMode")
                #form_xsrfToken()
                <h2 class="first">$action.getText("profile.group.personal")</h2>
                <fieldset>
                    <input type="hidden" id="originalemail" value="$storedEmail"/>
                    <input type="hidden" id="passwordconfirmation" value="" name="passwordconfirmation"/>

                    ## User details -- Full name and Email
                    #if (!$settingsManager.getGlobalSettings().isExternalUserManagement() && !$userAccessor.isReadOnly($user))
                        #stextfield("label='fullname.name'" "name='fullName'" "size='50'" "theme='aui'"
                                    "required=$action.getText('required.field')")
                        #stextfield("label='email.name'" "name='email'" "size='50'" "theme='aui'" )
                    #else
                        <strong class="extra-info">$action.getText('user.fields.readonly')</strong>
                        #stextfield("label='fullname.name'" "name='fullName'" "size='50'" "theme='aui'" "readonly=true" )
                        #stextfield("label='email.name'" "name='email'" "size='50'" "theme='aui'" "readonly=true" )
                    #end

                    ## User details -- Phone, IM, Website, etc.
                    #foreach ($key in $action.getUserDetailsKeys("personal"))
                        #stextfield("label='confluence.user.profile.$key'" "name='userparam-$key'" "value=getUserProperty('$key')" "size='50'" "theme='aui'"
                                    "renderWiki=$statusTextRenderer")
                    #end

                    ## User details -- About me
                    #scomponent("name='personalInformation'" "template='textarea.vm'" "theme='aui'"
                                "label='personal.info'"
                                "rows=8"
                                "cols=70"
                                "renderWiki=$blockWikiStyleRenderer")
                    #end
                    <div class="field-group description">
                        #hint('input.accepts.wiki.markup')
                    </div>
                </fieldset>

                <h2>$action.getText("profile.group.business")</h2>
                <fieldset>
                    #foreach ($key in $action.getUserDetailsKeys("business"))
                        #stextfield("label='confluence.user.profile.$key'" "name='userparam-$key'" "value=getUserProperty('$key')" "size='50'" "theme='aui'"
                                    "renderWiki=$statusTextRenderer")
                    #end
                </fieldset>

                #if ($captchaManager.showCaptchaForCurrentUser())
                    #set ($captchaFormParams = { "captchaId": $captchaManager.generateCaptchaId(), "captchaErrors": $action.fieldErrors.get("captcha")})
                    $soyTemplateRendererHelper.getRenderedTemplateHtml("confluence.web.resources:shared-templates", "Confluence.Templates.Captcha.form.soy", $captchaFormParams)
                #end

                #ssubmit("theme='aui'"
                         "submitValue=$action.getText('save.name')")
            #end ## applyDecorator aui-form
        </div>
    </body>
    #end ## applyDecorator root
</html>
