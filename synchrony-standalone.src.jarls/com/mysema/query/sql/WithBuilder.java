package com.mysema.query.sql;

import com.mysema.query.QueryFlag;
import com.mysema.query.support.QueryMixin;
import com.mysema.query.types.Expression;
import com.mysema.query.types.Operation;
import com.mysema.query.types.OperationImpl;

public class WithBuilder<R> extends Object {
  private final QueryMixin<R> queryMixin;
  
  private final Expression<?> alias;
  
  public WithBuilder(QueryMixin<R> queryMixin, Expression<?> alias) {
    this.queryMixin = queryMixin;
    this.alias = alias;
  }
  
  public R as(Expression<?> expr) {
    Operation operation = OperationImpl.create(this.alias.getType(), SQLOps.WITH_ALIAS, this.alias, expr);
    return (R)this.queryMixin.addFlag(new QueryFlag(QueryFlag.Position.WITH, operation));
  }
}
