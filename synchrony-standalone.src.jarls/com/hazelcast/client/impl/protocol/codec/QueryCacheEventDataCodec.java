package com.hazelcast.client.impl.protocol.codec;

import com.hazelcast.client.impl.protocol.ClientMessage;
import com.hazelcast.client.impl.protocol.util.ParameterUtil;
import com.hazelcast.map.impl.querycache.event.DefaultQueryCacheEventData;
import com.hazelcast.map.impl.querycache.event.QueryCacheEventData;
import com.hazelcast.nio.serialization.Data;

public final class QueryCacheEventDataCodec {
  public static QueryCacheEventData decode(ClientMessage clientMessage) {
    DefaultQueryCacheEventData queryCacheEventData = new DefaultQueryCacheEventData();
    queryCacheEventData.setSequence(clientMessage.getLong());
    boolean isNullKey = clientMessage.getBoolean();
    if (!isNullKey)
      queryCacheEventData.setDataKey(clientMessage.getData()); 
    boolean isNullValue = clientMessage.getBoolean();
    if (!isNullValue)
      queryCacheEventData.setDataNewValue(clientMessage.getData()); 
    queryCacheEventData.setEventType(clientMessage.getInt());
    queryCacheEventData.setPartitionId(clientMessage.getInt());
    return queryCacheEventData;
  }
  
  public static void encode(QueryCacheEventData queryCacheEventData, ClientMessage clientMessage) {
    clientMessage.set(queryCacheEventData.getSequence());
    Data dataKey = queryCacheEventData.getDataKey();
    boolean isNullKey = (dataKey == null);
    clientMessage.set(isNullKey);
    if (!isNullKey)
      clientMessage.set(dataKey); 
    Data dataNewValue = queryCacheEventData.getDataNewValue();
    boolean isNullValue = (dataNewValue == null);
    clientMessage.set(isNullValue);
    if (!isNullValue)
      clientMessage.set(dataNewValue); 
    clientMessage.set(queryCacheEventData.getEventType());
    clientMessage.set(queryCacheEventData.getPartitionId());
  }
  
  public static int calculateDataSize(QueryCacheEventData queryCacheEventData) {
    dataSize = 8;
    dataSize++;
    Data dataKey = queryCacheEventData.getDataKey();
    boolean isNullKey = (dataKey == null);
    if (!isNullKey)
      dataSize += ParameterUtil.calculateDataSize(dataKey); 
    dataSize++;
    Data dataNewValue = queryCacheEventData.getDataNewValue();
    boolean isNullValue = (dataNewValue == null);
    if (!isNullValue)
      dataSize += ParameterUtil.calculateDataSize(dataNewValue); 
    dataSize += 4;
    return 4;
  }
}
