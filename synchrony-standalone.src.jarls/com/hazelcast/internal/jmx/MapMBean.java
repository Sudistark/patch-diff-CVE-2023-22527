package com.hazelcast.internal.jmx;

import com.hazelcast.core.IMap;
import com.hazelcast.internal.jmx.suppliers.LocalMapStatsSupplier;
import com.hazelcast.monitor.LocalMapStats;
import com.hazelcast.query.SqlPredicate;
import java.util.Collection;
import java.util.Map;
import java.util.Set;

@ManagedDescription("IMap")
public class MapMBean extends HazelcastMBean<IMap> {
  private final LocalStatsDelegate<LocalMapStats> localMapStatsDelegate;
  
  protected MapMBean(IMap managedObject, ManagementService service) {
    super(managedObject, service);
    this.objectName = service.createObjectName("IMap", managedObject.getName());
    LocalMapStatsSupplier localMapStatsSupplier1 = new LocalMapStatsSupplier(managedObject);
    this.localMapStatsDelegate = new LocalStatsDelegate(localMapStatsSupplier1, this.updateIntervalSec);
  }
  
  @ManagedAnnotation("localOwnedEntryCount")
  @ManagedDescription("number of entries owned on this member")
  public long getLocalOwnedEntryCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getOwnedEntryCount(); }
  
  @ManagedAnnotation("localBackupEntryCount")
  @ManagedDescription("the number of backup entries hold on this member")
  public long getLocalBackupEntryCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getBackupEntryCount(); }
  
  @ManagedAnnotation("localBackupCount")
  @ManagedDescription("the number of backups per entry on this member")
  public int getLocalBackupCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getBackupCount(); }
  
  @ManagedAnnotation("localOwnedEntryMemoryCost")
  @ManagedDescription("memory cost (number of bytes) of owned entries on this member")
  public long getLocalOwnedEntryMemoryCost() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getOwnedEntryMemoryCost(); }
  
  @ManagedAnnotation("localBackupEntryMemoryCost")
  @ManagedDescription("memory cost (number of bytes) of backup entries on this member.")
  public long getLocalBackupEntryMemoryCost() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getBackupEntryMemoryCost(); }
  
  @ManagedAnnotation("localCreationTime")
  @ManagedDescription("the creation time of this map on this member.")
  public long getLocalCreationTime() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getCreationTime(); }
  
  @ManagedAnnotation("localLastAccessTime")
  @ManagedDescription("the last access (read) time of the locally owned entries.")
  public long getLocalLastAccessTime() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getLastAccessTime(); }
  
  @ManagedAnnotation("localLastUpdateTime")
  @ManagedDescription("the last update time of the locally owned entries.")
  public long getLocalLastUpdateTime() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getLastUpdateTime(); }
  
  @ManagedAnnotation("localHits")
  @ManagedDescription("the number of hits (reads) of the locally owned entries.")
  public long getLocalHits() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getHits(); }
  
  @ManagedAnnotation("localLockedEntryCount")
  @ManagedDescription("the number of currently locked locally owned keys.")
  public long getLocalLockedEntryCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getLockedEntryCount(); }
  
  @ManagedAnnotation("localDirtyEntryCount")
  @ManagedDescription("the number of entries that the member owns and are dirty on this member")
  public long getLocalDirtyEntryCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getDirtyEntryCount(); }
  
  @ManagedAnnotation("localPutOperationCount")
  @ManagedDescription("the number of put operations on this member")
  public long getLocalPutOperationCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getPutOperationCount(); }
  
  @ManagedAnnotation("localGetOperationCount")
  @ManagedDescription("number of get operations on this member")
  public long getLocalGetOperationCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getGetOperationCount(); }
  
  @ManagedAnnotation("localRemoveOperationCount")
  @ManagedDescription("number of remove operations on this member")
  public long getLocalRemoveOperationCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getRemoveOperationCount(); }
  
  @ManagedAnnotation("localTotalPutLatency")
  @ManagedDescription("the total latency of put operations. To get the average latency, divide to number of puts")
  public long getLocalTotalPutLatency() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getTotalPutLatency(); }
  
  @ManagedAnnotation("localTotalGetLatency")
  @ManagedDescription("the total latency of get operations. To get the average latency, divide to number of gets")
  public long getLocalTotalGetLatency() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getTotalGetLatency(); }
  
  @ManagedAnnotation("localTotalRemoveLatency")
  @ManagedDescription("the total latency of remove operations. To get the average latency, divide to number of gets")
  public long getLocalTotalRemoveLatency() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getTotalRemoveLatency(); }
  
  @ManagedAnnotation("localMaxPutLatency")
  @ManagedDescription("the maximum latency of put operations. To get the average latency, divide to number of puts")
  public long getLocalMaxPutLatency() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getMaxPutLatency(); }
  
  @ManagedAnnotation("localMaxGetLatency")
  @ManagedDescription("the maximum latency of get operations. To get the average latency, divide to number of gets")
  public long getLocalMaxGetLatency() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getMaxGetLatency(); }
  
  @ManagedAnnotation("localMaxRemoveLatency")
  @ManagedDescription("the maximum latency of remove operations. To get the average latency, divide to number of gets")
  public long getMaxRemoveLatency() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getMaxRemoveLatency(); }
  
  @ManagedAnnotation("localEventOperationCount")
  @ManagedDescription("number of events received on this member")
  public long getLocalEventOperationCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getEventOperationCount(); }
  
  @ManagedAnnotation("localOtherOperationCount")
  @ManagedDescription("the total number of other operations on this member")
  public long getLocalOtherOperationCount() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getOtherOperationCount(); }
  
  @ManagedAnnotation("localTotal")
  @ManagedDescription("the total number of operations on this member")
  public long localTotal() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).total(); }
  
  @ManagedAnnotation("localHeapCost")
  @ManagedDescription("the total heap cost of map, Near Cache and heap cost")
  public long localHeapCost() { return ((LocalMapStats)this.localMapStatsDelegate.getLocalStats()).getHeapCost(); }
  
  @ManagedAnnotation("name")
  @ManagedDescription("name of the map")
  public String getName() { return ((IMap)this.managedObject).getName(); }
  
  @ManagedAnnotation("size")
  @ManagedDescription("size of the map")
  public int getSize() { return ((IMap)this.managedObject).size(); }
  
  @ManagedAnnotation("config")
  @ManagedDescription("MapConfig")
  public String getConfig() { return this.service.instance.getConfig().findMapConfig(((IMap)this.managedObject).getName()).toString(); }
  
  @ManagedAnnotation(value = "clear", operation = true)
  @ManagedDescription("Clear Map")
  public void clear() { ((IMap)this.managedObject).clear(); }
  
  @ManagedAnnotation(value = "values", operation = true)
  public String values(String query) {
    Collection coll;
    if (query != null && !query.isEmpty()) {
      SqlPredicate sqlPredicate = new SqlPredicate(query);
      coll = ((IMap)this.managedObject).values(sqlPredicate);
    } else {
      coll = ((IMap)this.managedObject).values();
    } 
    StringBuilder buf = new StringBuilder();
    if (coll.size() == 0) {
      buf.append("Empty");
    } else {
      buf.append("[");
      for (Object obj : coll) {
        buf.append(obj);
        buf.append(", ");
      } 
      buf.replace(buf.length() - 1, buf.length(), "]");
    } 
    return buf.toString();
  }
  
  @ManagedAnnotation(value = "entrySet", operation = true)
  public String entrySet(String query) {
    Set<Map.Entry> entrySet;
    if (query != null && !query.isEmpty()) {
      SqlPredicate sqlPredicate = new SqlPredicate(query);
      entrySet = ((IMap)this.managedObject).entrySet(sqlPredicate);
    } else {
      entrySet = ((IMap)this.managedObject).entrySet();
    } 
    StringBuilder buf = new StringBuilder();
    if (entrySet.size() == 0) {
      buf.append("Empty");
    } else {
      buf.append("[");
      for (Map.Entry entry : entrySet) {
        buf.append("{key:");
        buf.append(entry.getKey());
        buf.append(", value:");
        buf.append(entry.getValue());
        buf.append("}, ");
      } 
      buf.replace(buf.length() - 1, buf.length(), "]");
    } 
    return buf.toString();
  }
}
