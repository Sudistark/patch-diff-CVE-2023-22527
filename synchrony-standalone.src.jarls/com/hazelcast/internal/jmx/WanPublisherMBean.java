package com.hazelcast.internal.jmx;

import com.hazelcast.monitor.LocalWanPublisherStats;
import com.hazelcast.monitor.LocalWanStats;
import com.hazelcast.wan.WanReplicationService;
import java.util.Map;

@ManagedDescription("WanReplicationPublisher")
public class WanPublisherMBean extends HazelcastMBean<WanReplicationService> {
  private final String wanReplicationName;
  
  private final String targetGroupName;
  
  public WanPublisherMBean(WanReplicationService wanReplicationService, String wanReplicationName, String targetGroupName, ManagementService service) {
    super(wanReplicationService, service);
    this.wanReplicationName = wanReplicationName;
    this.targetGroupName = targetGroupName;
    this.objectName = service.createObjectName("WanReplicationPublisher", wanReplicationName + "." + targetGroupName);
  }
  
  @ManagedAnnotation("state")
  @ManagedDescription("State of the WAN replication publisher")
  public String getState() {
    Map<String, LocalWanStats> wanStats = ((WanReplicationService)this.managedObject).getStats();
    if (wanStats == null)
      return ""; 
    LocalWanStats wanReplicationStats = (LocalWanStats)wanStats.get(this.wanReplicationName);
    Map<String, LocalWanPublisherStats> wanDelegatingPublisherStats = wanReplicationStats.getLocalWanPublisherStats();
    LocalWanPublisherStats wanPublisherStats = (LocalWanPublisherStats)wanDelegatingPublisherStats.get(this.targetGroupName);
    return wanPublisherStats.getPublisherState().name();
  }
}
