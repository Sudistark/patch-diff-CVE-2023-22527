package com.hazelcast.multimap.impl.operations;

import com.hazelcast.multimap.impl.MultiMapContainer;
import com.hazelcast.multimap.impl.MultiMapService;
import com.hazelcast.spi.BackupAwareOperation;
import com.hazelcast.spi.Operation;
import com.hazelcast.spi.PartitionAwareOperation;
import com.hazelcast.spi.impl.MutatingOperation;

public class ClearOperation extends AbstractMultiMapOperation implements BackupAwareOperation, PartitionAwareOperation, MutatingOperation {
  private MultiMapContainer container;
  
  private boolean shouldBackup;
  
  public ClearOperation() {}
  
  public ClearOperation(String name) { super(name); }
  
  public void beforeRun() {
    this.container = getOrCreateContainer();
    this.shouldBackup = (this.container.size() > 0);
  }
  
  public void run() {
    this.container = getOrCreateContainer();
    this.response = Integer.valueOf(this.container.clear());
  }
  
  public void afterRun() {
    ((MultiMapService)getService()).getLocalMultiMapStatsImpl(this.name).incrementOtherOperations();
    if (this.shouldBackup)
      this.container.update(); 
  }
  
  public boolean shouldBackup() { return this.shouldBackup; }
  
  public Operation getBackupOperation() { return new ClearBackupOperation(this.name); }
  
  public int getId() { return 3; }
}
