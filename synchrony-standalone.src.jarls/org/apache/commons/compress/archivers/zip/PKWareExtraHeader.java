package org.apache.commons.compress.archivers.zip;

import java.util.Arrays;
import java.util.zip.ZipException;

public abstract class PKWareExtraHeader implements ZipExtraField {
  private final ZipShort headerId;
  
  private byte[] localData;
  
  private byte[] centralData;
  
  protected PKWareExtraHeader(ZipShort headerId) { this.headerId = headerId; }
  
  protected final void assertMinimalLength(int minimum, int length) throws ZipException {
    if (length < minimum)
      throw new ZipException(getClass().getName() + " is too short, only " + length + " bytes, expected at least " + minimum); 
  }
  
  public byte[] getCentralDirectoryData() {
    if (this.centralData != null)
      return ZipUtil.copy(this.centralData); 
    return getLocalFileDataData();
  }
  
  public ZipShort getCentralDirectoryLength() {
    if (this.centralData != null)
      return new ZipShort(this.centralData.length); 
    return getLocalFileDataLength();
  }
  
  public ZipShort getHeaderId() { return this.headerId; }
  
  public byte[] getLocalFileDataData() { return ZipUtil.copy(this.localData); }
  
  public ZipShort getLocalFileDataLength() { return new ZipShort((this.localData != null) ? this.localData.length : 0); }
  
  public void parseFromCentralDirectoryData(byte[] data, int offset, int length) throws ZipException {
    byte[] tmp = Arrays.copyOfRange(data, offset, offset + length);
    setCentralDirectoryData(tmp);
    if (this.localData == null)
      setLocalFileDataData(tmp); 
  }
  
  public void parseFromLocalFileData(byte[] data, int offset, int length) throws ZipException { setLocalFileDataData(Arrays.copyOfRange(data, offset, offset + length)); }
  
  public void setCentralDirectoryData(byte[] data) { this.centralData = ZipUtil.copy(data); }
  
  public void setLocalFileDataData(byte[] data) { this.localData = ZipUtil.copy(data); }
}
