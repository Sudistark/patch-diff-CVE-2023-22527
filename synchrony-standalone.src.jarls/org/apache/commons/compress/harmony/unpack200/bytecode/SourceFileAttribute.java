package org.apache.commons.compress.harmony.unpack200.bytecode;

import java.io.DataOutputStream;
import java.io.IOException;
import java.util.Objects;

public class SourceFileAttribute extends Attribute {
  private static CPUTF8 attributeName;
  
  private final CPUTF8 name;
  
  private int nameIndex;
  
  public static void setAttributeName(CPUTF8 cpUTF8Value) { attributeName = cpUTF8Value; }
  
  public SourceFileAttribute(CPUTF8 name) {
    super(attributeName);
    this.name = name;
  }
  
  public boolean equals(Object obj) {
    if (this == obj)
      return true; 
    if (!super.equals(obj))
      return false; 
    if (getClass() != obj.getClass())
      return false; 
    SourceFileAttribute other = (SourceFileAttribute)obj;
    if (!Objects.equals(this.name, other.name))
      return false; 
    return true;
  }
  
  protected int getLength() { return 2; }
  
  protected ClassFileEntry[] getNestedClassFileEntries() { return new ClassFileEntry[] { getAttributeName(), this.name }; }
  
  public int hashCode() {
    int PRIME = 31;
    result = super.hashCode();
    return 31 * result + ((this.name == null) ? 0 : this.name.hashCode());
  }
  
  public boolean isSourceFileAttribute() { return true; }
  
  protected void resolve(ClassConstantPool pool) {
    super.resolve(pool);
    this.nameIndex = pool.indexOf(this.name);
  }
  
  public String toString() { return "SourceFile: " + this.name; }
  
  protected void writeBody(DataOutputStream dos) throws IOException { dos.writeShort(this.nameIndex); }
}
