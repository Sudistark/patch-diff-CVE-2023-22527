package org.bouncycastle.cert.ocsp;

import java.io.OutputStream;
import java.util.ArrayList;
import java.util.Date;
import java.util.Iterator;
import java.util.List;
import org.bouncycastle.asn1.ASN1EncodableVector;
import org.bouncycastle.asn1.ASN1GeneralizedTime;
import org.bouncycastle.asn1.DERBitString;
import org.bouncycastle.asn1.DERSequence;
import org.bouncycastle.asn1.ocsp.BasicOCSPResponse;
import org.bouncycastle.asn1.ocsp.ResponseData;
import org.bouncycastle.asn1.x509.AlgorithmIdentifier;
import org.bouncycastle.asn1.x509.Extensions;
import org.bouncycastle.asn1.x509.SubjectPublicKeyInfo;
import org.bouncycastle.cert.X509CertificateHolder;
import org.bouncycastle.operator.ContentSigner;
import org.bouncycastle.operator.DigestCalculator;

public class BasicOCSPRespBuilder {
  private List list = new ArrayList();
  
  private Extensions responseExtensions = null;
  
  private RespID responderID;
  
  public BasicOCSPRespBuilder(RespID paramRespID) { this.responderID = paramRespID; }
  
  public BasicOCSPRespBuilder(SubjectPublicKeyInfo paramSubjectPublicKeyInfo, DigestCalculator paramDigestCalculator) throws OCSPException { this.responderID = new RespID(paramSubjectPublicKeyInfo, paramDigestCalculator); }
  
  public BasicOCSPRespBuilder addResponse(CertificateID paramCertificateID, CertificateStatus paramCertificateStatus) {
    addResponse(paramCertificateID, paramCertificateStatus, new Date(), null, null);
    return this;
  }
  
  public BasicOCSPRespBuilder addResponse(CertificateID paramCertificateID, CertificateStatus paramCertificateStatus, Extensions paramExtensions) {
    addResponse(paramCertificateID, paramCertificateStatus, new Date(), null, paramExtensions);
    return this;
  }
  
  public BasicOCSPRespBuilder addResponse(CertificateID paramCertificateID, CertificateStatus paramCertificateStatus, Date paramDate, Extensions paramExtensions) {
    addResponse(paramCertificateID, paramCertificateStatus, new Date(), paramDate, paramExtensions);
    return this;
  }
  
  public BasicOCSPRespBuilder addResponse(CertificateID paramCertificateID, CertificateStatus paramCertificateStatus, Date paramDate1, Date paramDate2) {
    addResponse(paramCertificateID, paramCertificateStatus, paramDate1, paramDate2, null);
    return this;
  }
  
  public BasicOCSPRespBuilder addResponse(CertificateID paramCertificateID, CertificateStatus paramCertificateStatus, Date paramDate1, Date paramDate2, Extensions paramExtensions) {
    this.list.add(new ResponseObject(this, paramCertificateID, paramCertificateStatus, paramDate1, paramDate2, paramExtensions));
    return this;
  }
  
  public BasicOCSPRespBuilder setResponseExtensions(Extensions paramExtensions) {
    this.responseExtensions = paramExtensions;
    return this;
  }
  
  public BasicOCSPResp build(ContentSigner paramContentSigner, X509CertificateHolder[] paramArrayOfX509CertificateHolder, Date paramDate) throws OCSPException {
    DERBitString dERBitString;
    Iterator iterator = this.list.iterator();
    ASN1EncodableVector aSN1EncodableVector = new ASN1EncodableVector();
    while (iterator.hasNext()) {
      try {
        aSN1EncodableVector.add(((ResponseObject)iterator.next()).toResponse());
      } catch (Exception exception) {
        throw new OCSPException("exception creating Request", exception);
      } 
    } 
    ResponseData responseData = new ResponseData(this.responderID.toASN1Primitive(), new ASN1GeneralizedTime(paramDate), new DERSequence(aSN1EncodableVector), this.responseExtensions);
    try {
      OutputStream outputStream = paramContentSigner.getOutputStream();
      outputStream.write(responseData.getEncoded("DER"));
      outputStream.close();
      dERBitString = new DERBitString(paramContentSigner.getSignature());
    } catch (Exception exception) {
      throw new OCSPException("exception processing TBSRequest: " + exception.getMessage(), exception);
    } 
    AlgorithmIdentifier algorithmIdentifier = paramContentSigner.getAlgorithmIdentifier();
    DERSequence dERSequence = null;
    if (paramArrayOfX509CertificateHolder != null && paramArrayOfX509CertificateHolder.length > 0) {
      ASN1EncodableVector aSN1EncodableVector1 = new ASN1EncodableVector();
      for (byte b = 0; b != paramArrayOfX509CertificateHolder.length; b++)
        aSN1EncodableVector1.add(paramArrayOfX509CertificateHolder[b].toASN1Structure()); 
      dERSequence = new DERSequence(aSN1EncodableVector1);
    } 
    return new BasicOCSPResp(new BasicOCSPResponse(responseData, algorithmIdentifier, dERBitString, dERSequence));
  }
}
