package com.mysema.query.types.query;

import com.mysema.query.QueryMetadata;
import com.mysema.query.types.Ops;
import com.mysema.query.types.SubQueryExpressionImpl;
import com.mysema.query.types.Visitor;
import com.mysema.query.types.expr.BooleanExpression;
import com.mysema.query.types.expr.BooleanOperation;
import com.mysema.query.types.expr.TimeExpression;
import javax.annotation.Nullable;

public final class TimeSubQuery<T extends Comparable<?>> extends TimeExpression<T> implements ExtendedSubQueryExpression<T> {
  private static final long serialVersionUID = -64156984110154969L;
  
  private final SubQueryExpressionImpl<T> subQueryMixin;
  
  public TimeSubQuery(Class<T> type, QueryMetadata md) {
    super(new SubQueryExpressionImpl(type, md));
    this.subQueryMixin = (SubQueryExpressionImpl)this.mixin;
  }
  
  public <R, C> R accept(Visitor<R, C> v, C context) { return (R)v.visit(this.subQueryMixin, context); }
  
  public BooleanExpression exists() {
    if (this.exists == null)
      this.exists = BooleanOperation.create(Ops.EXISTS, this.mixin); 
    return this.exists;
  }
  
  public QueryMetadata getMetadata() { return this.subQueryMixin.getMetadata(); }
  
  public BooleanExpression notExists() { return exists().not(); }
}
