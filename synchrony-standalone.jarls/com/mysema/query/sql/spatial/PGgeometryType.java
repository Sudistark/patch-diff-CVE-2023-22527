package com.mysema.query.sql.spatial;

import com.mysema.query.sql.types.AbstractType;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import javax.annotation.Nullable;
import org.geolatte.geom.Geometry;
import org.geolatte.geom.codec.Wkt;
import org.postgis.PGgeometry;

public class PGgeometryType extends AbstractType<Geometry> {
  public static final PGgeometryType DEFAULT = new PGgeometryType();
  
  public PGgeometryType() { super(2002); }
  
  public Class<Geometry> getReturnedClass() { return Geometry.class; }
  
  @Nullable
  public Geometry getValue(ResultSet rs, int startIndex) throws SQLException {
    Object obj = rs.getObject(startIndex);
    return (obj != null) ? PGgeometryConverter.convert(((PGgeometry)obj).getGeometry()) : null;
  }
  
  public void setValue(PreparedStatement st, int startIndex, Geometry value) throws SQLException {
    PGgeometry geometry = new PGgeometry(PGgeometryConverter.convert(value));
    st.setObject(startIndex, geometry);
  }
  
  public String getLiteral(Geometry geometry) { return "'" + Wkt.newEncoder(Wkt.Dialect.POSTGIS_EWKT_1).encode(geometry) + "'"; }
}
