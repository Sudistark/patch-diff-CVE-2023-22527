package com.mysema.query.support;

import com.google.common.collect.Lists;
import com.mysema.query.DefaultQueryMetadata;
import com.mysema.query.JoinExpression;
import com.mysema.query.JoinType;
import com.mysema.query.types.Expression;
import java.util.List;

public class OrderedQueryMetadata extends DefaultQueryMetadata {
  private static final long serialVersionUID = 6326236143414219377L;
  
  private List<JoinExpression> joins;
  
  public OrderedQueryMetadata() { noValidate(); }
  
  public void addJoin(JoinType joinType, Expression<?> expr) {
    this.joins = null;
    super.addJoin(joinType, expr);
  }
  
  public List<JoinExpression> getJoins() {
    if (this.joins == null) {
      this.joins = Lists.newArrayList();
      int separator = 0;
      for (JoinExpression j : super.getJoins()) {
        if (j.getType() == JoinType.DEFAULT) {
          this.joins.add(separator++, j);
          continue;
        } 
        this.joins.add(j);
      } 
    } 
    return this.joins;
  }
}
