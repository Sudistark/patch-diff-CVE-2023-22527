package com.hazelcast.transaction.impl.xa.operations;

import com.hazelcast.nio.serialization.Data;
import com.hazelcast.spi.NodeEngine;
import com.hazelcast.spi.impl.SerializableList;
import com.hazelcast.transaction.impl.xa.SerializableXID;
import com.hazelcast.transaction.impl.xa.XAService;
import java.util.ArrayList;
import java.util.List;
import java.util.Set;

public class CollectRemoteTransactionsOperation extends AbstractXAOperation {
  private SerializableList xidSet;
  
  public void run() {
    XAService xaService = (XAService)getService();
    NodeEngine nodeEngine = getNodeEngine();
    Set<SerializableXID> xids = xaService.getPreparedXids();
    List<Data> xidSet = new ArrayList<Data>();
    for (SerializableXID xid : xids)
      xidSet.add(nodeEngine.toData(xid)); 
    this.xidSet = new SerializableList(xidSet);
  }
  
  public Object getResponse() { return this.xidSet; }
  
  public int getId() { return 11; }
}
