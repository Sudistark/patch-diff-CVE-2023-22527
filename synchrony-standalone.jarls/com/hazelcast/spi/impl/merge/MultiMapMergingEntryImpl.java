package com.hazelcast.spi.impl.merge;

import com.hazelcast.nio.IOUtil;
import com.hazelcast.nio.ObjectDataInput;
import com.hazelcast.nio.ObjectDataOutput;
import com.hazelcast.nio.serialization.Data;
import com.hazelcast.nio.serialization.IdentifiedDataSerializable;
import com.hazelcast.spi.merge.SplitBrainMergeTypes;
import com.hazelcast.spi.serialization.SerializationService;
import com.hazelcast.spi.serialization.SerializationServiceAware;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Collection;

public class MultiMapMergingEntryImpl implements SplitBrainMergeTypes.MultiMapMergeTypes, SerializationServiceAware, IdentifiedDataSerializable {
  private Data key;
  
  private Collection<Object> value;
  
  private long creationTime = -1L;
  
  private long expirationTime = -1L;
  
  private long hits = -1L;
  
  private long lastAccessTime = -1L;
  
  private long lastUpdateTime = -1L;
  
  private SerializationService serializationService;
  
  public MultiMapMergingEntryImpl(SerializationService serializationService) { this.serializationService = serializationService; }
  
  public Data getKey() { return this.key; }
  
  public <DK> DK getDeserializedKey() { return (DK)this.serializationService.toObject(this.key); }
  
  public MultiMapMergingEntryImpl setKey(Data key) {
    this.key = key;
    return this;
  }
  
  public Collection<Object> getValue() { return this.value; }
  
  public <DV> DV getDeserializedValue() {
    Collection<Object> deserializedValues = new ArrayList<Object>(this.value.size());
    for (Object aValue : this.value)
      deserializedValues.add(this.serializationService.toObject(aValue)); 
    return (DV)deserializedValues;
  }
  
  public MultiMapMergingEntryImpl setValues(Collection<Object> values) {
    this.value = values;
    return this;
  }
  
  public long getCreationTime() { return this.creationTime; }
  
  public MultiMapMergingEntryImpl setCreationTime(long creationTime) {
    this.creationTime = creationTime;
    return this;
  }
  
  public long getHits() { return this.hits; }
  
  public MultiMapMergingEntryImpl setHits(long hits) {
    this.hits = hits;
    return this;
  }
  
  public long getLastAccessTime() { return this.lastAccessTime; }
  
  public MultiMapMergingEntryImpl setLastAccessTime(long lastAccessTime) {
    this.lastAccessTime = lastAccessTime;
    return this;
  }
  
  public long getLastUpdateTime() { return this.lastUpdateTime; }
  
  public MultiMapMergingEntryImpl setLastUpdateTime(long lastUpdateTime) {
    this.lastUpdateTime = lastUpdateTime;
    return this;
  }
  
  public void setSerializationService(SerializationService serializationService) { this.serializationService = serializationService; }
  
  public void writeData(ObjectDataOutput out) throws IOException {
    IOUtil.writeObject(out, this.key);
    out.writeInt(this.value.size());
    for (Object aValue : this.value)
      out.writeObject(aValue); 
    out.writeLong(this.creationTime);
    out.writeLong(this.expirationTime);
    out.writeLong(this.hits);
    out.writeLong(this.lastAccessTime);
    out.writeLong(this.lastUpdateTime);
  }
  
  public void readData(ObjectDataInput in) throws IOException {
    this.key = (Data)IOUtil.readObject(in);
    int size = in.readInt();
    this.value = new ArrayList(size);
    for (int i = 0; i < size; i++)
      this.value.add(in.readObject()); 
    this.creationTime = in.readLong();
    this.expirationTime = in.readLong();
    this.hits = in.readLong();
    this.lastAccessTime = in.readLong();
    this.lastUpdateTime = in.readLong();
  }
  
  public int getFactoryId() { return SplitBrainDataSerializerHook.F_ID; }
  
  public int getId() { return 6; }
  
  public boolean equals(Object o) {
    if (this == o)
      return true; 
    if (o == null || getClass() != o.getClass())
      return false; 
    MultiMapMergingEntryImpl that = (MultiMapMergingEntryImpl)o;
    if (this.creationTime != that.creationTime)
      return false; 
    if (this.expirationTime != that.expirationTime)
      return false; 
    if (this.hits != that.hits)
      return false; 
    if (this.lastAccessTime != that.lastAccessTime)
      return false; 
    if (this.lastUpdateTime != that.lastUpdateTime)
      return false; 
    if ((this.key != null) ? !this.key.equals(that.key) : (that.key != null))
      return false; 
    return (this.value != null) ? this.value.equals(that.value) : ((that.value == null) ? 1 : 0);
  }
  
  public int hashCode() {
    result = (this.key != null) ? this.key.hashCode() : 0;
    result = 31 * result + ((this.value != null) ? this.value.hashCode() : 0);
    result = 31 * result + (int)(this.creationTime ^ this.creationTime >>> 32);
    result = 31 * result + (int)(this.expirationTime ^ this.expirationTime >>> 32);
    result = 31 * result + (int)(this.hits ^ this.hits >>> 32);
    result = 31 * result + (int)(this.lastAccessTime ^ this.lastAccessTime >>> 32);
    return 31 * result + (int)(this.lastUpdateTime ^ this.lastUpdateTime >>> 32);
  }
  
  public String toString() { return "MultiMapMergingEntry{key=" + this.key + ", value=" + this.value + ", creationTime=" + this.creationTime + ", expirationTime=" + this.expirationTime + ", hits=" + this.hits + ", lastAccessTime=" + this.lastAccessTime + ", lastUpdateTime=" + this.lastUpdateTime + '}'; }
  
  public MultiMapMergingEntryImpl() {}
}
