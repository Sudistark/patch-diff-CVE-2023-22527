package com.hazelcast.map.impl.record;

import com.hazelcast.config.MapConfig;
import com.hazelcast.nio.serialization.Data;
import com.hazelcast.spi.serialization.SerializationService;

public class ObjectRecordFactory extends Object implements RecordFactory<Object> {
  private final SerializationService serializationService;
  
  private final boolean statisticsEnabled;
  
  public ObjectRecordFactory(MapConfig config, SerializationService serializationService) {
    this.serializationService = serializationService;
    this.statisticsEnabled = config.isStatisticsEnabled();
  }
  
  public Record<Object> newRecord(Data key, Object value) {
    assert value != null : "value can not be null";
    Object objectValue = this.serializationService.toObject(value);
    return this.statisticsEnabled ? new ObjectRecordWithStats(objectValue) : new ObjectRecord(objectValue);
  }
  
  public void setValue(Record<Object> record, Object value) {
    assert value != null : "value can not be null";
    Object v = value;
    if (value instanceof Data)
      v = this.serializationService.toObject(value); 
    record.setValue(v);
  }
}
