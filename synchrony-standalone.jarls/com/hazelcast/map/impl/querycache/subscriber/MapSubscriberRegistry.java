package com.hazelcast.map.impl.querycache.subscriber;

import com.hazelcast.map.impl.querycache.QueryCacheContext;
import com.hazelcast.map.impl.querycache.Registry;
import com.hazelcast.util.ConcurrencyUtil;
import com.hazelcast.util.ConstructorFunction;
import java.util.Collections;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ConcurrentMap;

public class MapSubscriberRegistry extends Object implements Registry<String, SubscriberRegistry> {
  private final ConstructorFunction<String, SubscriberRegistry> registryConstructorFunction;
  
  private final QueryCacheContext context;
  
  private final ConcurrentMap<String, SubscriberRegistry> cachePublishersPerIMap;
  
  public MapSubscriberRegistry(QueryCacheContext context) {
    this.registryConstructorFunction = new Object(this);
    this.context = context;
    this.cachePublishersPerIMap = new ConcurrentHashMap();
  }
  
  public SubscriberRegistry getOrCreate(String mapName) { return (SubscriberRegistry)ConcurrencyUtil.getOrPutIfAbsent(this.cachePublishersPerIMap, mapName, this.registryConstructorFunction); }
  
  public SubscriberRegistry getOrNull(String mapName) { return (SubscriberRegistry)this.cachePublishersPerIMap.get(mapName); }
  
  public Map<String, SubscriberRegistry> getAll() { return Collections.unmodifiableMap(this.cachePublishersPerIMap); }
  
  public SubscriberRegistry remove(String mapName) { return (SubscriberRegistry)this.cachePublishersPerIMap.remove(mapName); }
  
  protected SubscriberRegistry createSubscriberRegistry(String mapName) { return new SubscriberRegistry(this.context, mapName); }
  
  protected QueryCacheContext getContext() { return this.context; }
}
