package com.hazelcast.map.impl.operation;

import com.hazelcast.config.MapStoreConfig;
import com.hazelcast.spi.BackupAwareOperation;
import com.hazelcast.spi.Operation;
import com.hazelcast.spi.impl.MutatingOperation;

public class MapFlushOperation extends MapOperation implements BackupAwareOperation, MutatingOperation {
  private long sequence;
  
  public MapFlushOperation() {}
  
  public MapFlushOperation(String name) { super(name); }
  
  public void run() { this.sequence = this.recordStore.softFlush(); }
  
  public Object getResponse() { return Long.valueOf(this.sequence); }
  
  public boolean shouldBackup() {
    MapStoreConfig mapStoreConfig = this.mapContainer.getMapConfig().getMapStoreConfig();
    return (mapStoreConfig != null && mapStoreConfig
      .isEnabled() && mapStoreConfig
      .getWriteDelaySeconds() > 0);
  }
  
  public int getAsyncBackupCount() { return this.mapContainer.getAsyncBackupCount(); }
  
  public int getSyncBackupCount() { return this.mapContainer.getBackupCount(); }
  
  public Operation getBackupOperation() { return new MapFlushBackupOperation(this.name); }
  
  public int getId() { return 50; }
}
