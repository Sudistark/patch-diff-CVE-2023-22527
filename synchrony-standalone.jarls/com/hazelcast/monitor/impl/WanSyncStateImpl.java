package com.hazelcast.monitor.impl;

import com.hazelcast.internal.json.JsonObject;
import com.hazelcast.monitor.WanSyncState;
import com.hazelcast.util.Clock;
import com.hazelcast.wan.WanSyncStatus;

public class WanSyncStateImpl implements WanSyncState {
  private long creationTime;
  
  private WanSyncStatus status = WanSyncStatus.READY;
  
  private int syncedPartitionCount;
  
  private String activeWanConfigName;
  
  private String activePublisherName;
  
  public WanSyncStateImpl() {}
  
  public WanSyncStateImpl(WanSyncStatus status, int syncedPartitionCount, String activeWanConfigName, String activePublisherName) {
    this.creationTime = Clock.currentTimeMillis();
    this.status = status;
    this.syncedPartitionCount = syncedPartitionCount;
    this.activeWanConfigName = activeWanConfigName;
    this.activePublisherName = activePublisherName;
  }
  
  public long getCreationTime() { return this.creationTime; }
  
  public WanSyncStatus getStatus() { return this.status; }
  
  public int getSyncedPartitionCount() { return this.syncedPartitionCount; }
  
  public String getActiveWanConfigName() { return this.activeWanConfigName; }
  
  public String getActivePublisherName() { return this.activePublisherName; }
  
  public JsonObject toJson() {
    JsonObject root = new JsonObject();
    root.add("creationTime", this.creationTime);
    root.add("status", this.status.getStatus());
    root.add("syncedPartitionCount", this.syncedPartitionCount);
    if (this.activeWanConfigName != null)
      root.add("activeWanConfigName", this.activeWanConfigName); 
    if (this.activePublisherName != null)
      root.add("activePublisherName", this.activePublisherName); 
    return root;
  }
  
  public void fromJson(JsonObject json) {
    this.creationTime = json.getLong("creationTime", -1L);
    int status = json.getInt("status", WanSyncStatus.READY.getStatus());
    this.status = WanSyncStatus.getByStatus(status);
    this.syncedPartitionCount = json.getInt("syncedPartitionCount", 0);
    this.activeWanConfigName = json.getString("activeWanConfigName", null);
    this.activePublisherName = json.getString("activePublisherName", null);
  }
  
  public String toString() { return "WanSyncStateImpl{wanSyncStatus=" + this.status + ", syncedPartitionCount=" + this.syncedPartitionCount + ", activeWanConfigName=" + this.activeWanConfigName + ", activePublisherName=" + this.activePublisherName + '}'; }
}
