package com.hazelcast.monitor.impl;

import com.hazelcast.internal.json.JsonObject;
import com.hazelcast.memory.GarbageCollectorStats;
import com.hazelcast.memory.MemoryStats;
import com.hazelcast.monitor.LocalGCStats;
import com.hazelcast.monitor.LocalMemoryStats;
import com.hazelcast.util.JsonUtil;

public class LocalMemoryStatsImpl implements LocalMemoryStats {
  public static final String JSON_CREATION_TIME = "creationTime";
  
  public static final String JSON_TOTAL_PHYSICAL = "totalPhysical";
  
  public static final String JSON_FREE_PHYSICAL = "freePhysical";
  
  public static final String JSON_MAX_NATIVE_MEMORY = "maxNativeMemory";
  
  public static final String JSON_COMMITTED_NATIVE_MEMORY = "committedNativeMemory";
  
  public static final String JSON_USED_NATIVE_MEMORY = "usedNativeMemory";
  
  public static final String JSON_FREE_NATIVE_MEMORY = "freeNativeMemory";
  
  public static final String JSON_MAX_HEAP = "maxHeap";
  
  public static final String JSON_COMMITTED_HEAP = "committedHeap";
  
  public static final String JSON_USED_HEAP = "usedHeap";
  
  public static final String JSON_GC_STATS = "gcStats";
  
  private long creationTime;
  
  private long totalPhysical;
  
  private long freePhysical;
  
  private long maxNativeMemory;
  
  private long committedNativeMemory;
  
  private long usedNativeMemory;
  
  private long freeNativeMemory;
  
  private long maxMetadata;
  
  private long usedMetadata;
  
  private long maxHeap;
  
  private long committedHeap;
  
  private long usedHeap;
  
  private LocalGCStats gcStats;
  
  public LocalMemoryStatsImpl() {}
  
  public LocalMemoryStatsImpl(MemoryStats memoryStats) {
    setTotalPhysical(memoryStats.getTotalPhysical());
    setFreePhysical(memoryStats.getFreePhysical());
    setMaxNativeMemory(memoryStats.getMaxNative());
    setCommittedNativeMemory(memoryStats.getCommittedNative());
    setUsedNativeMemory(memoryStats.getUsedNative());
    setFreeNativeMemory(memoryStats.getFreeNative());
    setMaxMetadata(memoryStats.getMaxMetadata());
    setUsedMetadata(memoryStats.getUsedMetadata());
    setMaxHeap(memoryStats.getMaxHeap());
    setCommittedHeap(memoryStats.getCommittedHeap());
    setUsedHeap(memoryStats.getUsedHeap());
    setGcStats(new LocalGCStatsImpl(memoryStats.getGCStats()));
  }
  
  public long getTotalPhysical() { return this.totalPhysical; }
  
  public void setTotalPhysical(long totalPhysical) { this.totalPhysical = totalPhysical; }
  
  public long getFreePhysical() { return this.freePhysical; }
  
  public void setFreePhysical(long freePhysical) { this.freePhysical = freePhysical; }
  
  public long getMaxNative() { return this.maxNativeMemory; }
  
  public void setMaxNativeMemory(long maxNativeMemory) { this.maxNativeMemory = maxNativeMemory; }
  
  public long getCommittedNative() { return this.committedNativeMemory; }
  
  public void setCommittedNativeMemory(long committed) { this.committedNativeMemory = committed; }
  
  public long getUsedNative() { return this.usedNativeMemory; }
  
  public void setUsedNativeMemory(long used) { this.usedNativeMemory = used; }
  
  public long getFreeNative() { return this.freeNativeMemory; }
  
  public void setFreeNativeMemory(long freeNativeMemory) { this.freeNativeMemory = freeNativeMemory; }
  
  public long getMaxMetadata() { return this.maxMetadata; }
  
  public void setMaxMetadata(long maxMetadata) { this.maxMetadata = maxMetadata; }
  
  public long getUsedMetadata() { return this.usedMetadata; }
  
  public void setUsedMetadata(long usedMetadata) { this.usedMetadata = usedMetadata; }
  
  public long getMaxHeap() { return this.maxHeap; }
  
  public long getCommittedHeap() { return this.committedHeap; }
  
  public long getUsedHeap() { return this.usedHeap; }
  
  public void setMaxHeap(long maxHeap) { this.maxHeap = maxHeap; }
  
  public void setCommittedHeap(long committedHeap) { this.committedHeap = committedHeap; }
  
  public void setUsedHeap(long usedHeap) { this.usedHeap = usedHeap; }
  
  public long getFreeHeap() { return this.maxHeap - this.usedHeap; }
  
  public LocalGCStats getGCStats() { return this.gcStats; }
  
  public void setGcStats(LocalGCStats gcStats) { this.gcStats = gcStats; }
  
  public long getCreationTime() { return this.creationTime; }
  
  public JsonObject toJson() {
    JsonObject root = new JsonObject();
    root.add("creationTime", this.creationTime);
    root.add("totalPhysical", this.totalPhysical);
    root.add("freePhysical", this.freePhysical);
    root.add("maxNativeMemory", this.maxNativeMemory);
    root.add("committedNativeMemory", this.committedNativeMemory);
    root.add("usedNativeMemory", this.usedNativeMemory);
    root.add("freeNativeMemory", this.freeNativeMemory);
    root.add("maxHeap", this.maxHeap);
    root.add("committedHeap", this.committedHeap);
    root.add("usedHeap", this.usedHeap);
    if (this.gcStats == null)
      this.gcStats = new LocalGCStatsImpl(); 
    root.add("gcStats", this.gcStats.toJson());
    return root;
  }
  
  public void fromJson(JsonObject json) {
    this.creationTime = JsonUtil.getLong(json, "creationTime", -1L);
    this.totalPhysical = JsonUtil.getLong(json, "totalPhysical", -1L);
    this.freePhysical = JsonUtil.getLong(json, "freePhysical", -1L);
    this.maxNativeMemory = JsonUtil.getLong(json, "maxNativeMemory", -1L);
    this.committedNativeMemory = JsonUtil.getLong(json, "committedNativeMemory", -1L);
    this.usedNativeMemory = JsonUtil.getLong(json, "usedNativeMemory", -1L);
    this.freeNativeMemory = JsonUtil.getLong(json, "freeNativeMemory", -1L);
    this.maxHeap = JsonUtil.getLong(json, "maxHeap", -1L);
    this.committedHeap = JsonUtil.getLong(json, "committedHeap", -1L);
    this.usedHeap = JsonUtil.getLong(json, "usedHeap", -1L);
    this.gcStats = new LocalGCStatsImpl();
    if (json.get("gcStats") != null)
      this.gcStats.fromJson(JsonUtil.getObject(json, "gcStats")); 
  }
  
  public String toString() { return "LocalMemoryStats{totalPhysical=" + this.totalPhysical + ", freePhysical=" + this.freePhysical + ", maxNativeMemory=" + this.maxNativeMemory + ", committedNativeMemory=" + this.committedNativeMemory + ", usedNativeMemory=" + this.usedNativeMemory + ", maxMetadata=" + this.maxMetadata + ", usedUsedMetadata=" + this.usedMetadata + ", maxHeap=" + this.maxHeap + ", committedHeap=" + this.committedHeap + ", usedHeap=" + this.usedHeap + ", gcStats=" + this.gcStats + '}'; }
}
