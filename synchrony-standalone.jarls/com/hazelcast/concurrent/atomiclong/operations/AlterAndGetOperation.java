package com.hazelcast.concurrent.atomiclong.operations;

import com.hazelcast.concurrent.atomiclong.AtomicLongContainer;
import com.hazelcast.core.IFunction;

public class AlterAndGetOperation extends AbstractAlterOperation {
  public AlterAndGetOperation() {}
  
  public AlterAndGetOperation(String name, IFunction<Long, Long> function) { super(name, function); }
  
  public void run() {
    AtomicLongContainer container = getLongContainer();
    long input = container.get();
    long output = ((Long)this.function.apply(Long.valueOf(input))).longValue();
    this.shouldBackup = (input != output);
    if (this.shouldBackup) {
      this.backup = output;
      container.set(output);
    } 
    this.response = output;
  }
  
  public int getId() { return 3; }
}
