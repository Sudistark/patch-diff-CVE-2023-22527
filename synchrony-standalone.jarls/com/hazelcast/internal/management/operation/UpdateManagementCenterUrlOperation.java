package com.hazelcast.internal.management.operation;

import com.hazelcast.internal.management.ManagementCenterService;
import com.hazelcast.nio.ObjectDataInput;
import com.hazelcast.nio.ObjectDataOutput;
import com.hazelcast.spi.impl.NodeEngineImpl;
import java.io.IOException;

public class UpdateManagementCenterUrlOperation extends AbstractManagementOperation {
  private static final int REDO_COUNT = 10;
  
  private static final int SLEEP_MILLIS = 1000;
  
  private String newUrl;
  
  public UpdateManagementCenterUrlOperation() {}
  
  public UpdateManagementCenterUrlOperation(String newUrl) { this.newUrl = newUrl; }
  
  public void run() {
    ManagementCenterService service = ((NodeEngineImpl)getNodeEngine()).getManagementCenterService();
    int count = 0;
    while (service == null && count < 10) {
      Thread.sleep(1000L);
      count++;
      service = ((NodeEngineImpl)getNodeEngine()).getManagementCenterService();
    } 
    if (service != null)
      service.updateManagementCenterUrl(this.newUrl); 
  }
  
  protected void writeInternal(ObjectDataOutput out) throws IOException { out.writeUTF(this.newUrl); }
  
  protected void readInternal(ObjectDataInput in) throws IOException { this.newUrl = in.readUTF(); }
  
  public int getId() { return 1; }
}
