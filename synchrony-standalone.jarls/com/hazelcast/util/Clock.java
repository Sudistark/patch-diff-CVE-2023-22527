package com.hazelcast.util;

import com.hazelcast.nio.ClassLoaderUtil;

public final class Clock {
  public static long currentTimeMillis() { return CLOCK.currentTimeMillis(); }
  
  private static final ClockImpl CLOCK = createClock();
  
  static ClockImpl createClock() {
    clockImplClassName = System.getProperty("com.hazelcast.clock.impl");
    if (clockImplClassName != null)
      try {
        return (ClockImpl)ClassLoaderUtil.newInstance(null, clockImplClassName);
      } catch (Exception e) {
        throw ExceptionUtil.rethrow(e);
      }  
    String clockOffset = System.getProperty("com.hazelcast.clock.offset");
    long offset = 0L;
    if (clockOffset != null)
      try {
        offset = Long.parseLong(clockOffset);
      } catch (NumberFormatException e) {
        throw ExceptionUtil.rethrow(e);
      }  
    if (offset != 0L)
      return new SystemOffsetClock(offset); 
    return new SystemClock();
  }
}
