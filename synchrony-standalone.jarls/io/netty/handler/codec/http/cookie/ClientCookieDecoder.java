package io.netty.handler.codec.http.cookie;

import io.netty.util.internal.ObjectUtil;

public final class ClientCookieDecoder extends CookieDecoder {
  public static final ClientCookieDecoder STRICT = new ClientCookieDecoder(true);
  
  public static final ClientCookieDecoder LAX = new ClientCookieDecoder(false);
  
  private ClientCookieDecoder(boolean strict) { super(strict); }
  
  public Cookie decode(String header) {
    int headerLen = ((String)ObjectUtil.checkNotNull(header, "header")).length();
    if (headerLen == 0)
      return null; 
    CookieBuilder cookieBuilder = null;
    int i = 0;
    while (i != headerLen) {
      int valueEnd, valueBegin, nameEnd;
      char c = header.charAt(i);
      if (c == ',')
        break; 
      if (c == '\t' || c == '\n' || c == '\013' || c == '\f' || c == '\r' || c == ' ' || c == ';') {
        i++;
        continue;
      } 
      int nameBegin = i;
      while (true) {
        char curChar = header.charAt(i);
        if (curChar == ';') {
          nameEnd = i;
          valueBegin = valueEnd = -1;
          break;
        } 
        if (curChar == '=') {
          nameEnd = i;
          i++;
          if (i == headerLen) {
            int valueEnd = 0, valueBegin = valueEnd;
            break;
          } 
          valueBegin = i;
          int semiPos = header.indexOf(';', i);
          valueEnd = i = (semiPos > 0) ? semiPos : headerLen;
          break;
        } 
        i++;
        if (i == headerLen) {
          nameEnd = headerLen;
          valueBegin = valueEnd = -1;
          break;
        } 
      } 
      if (valueEnd > 0 && header.charAt(valueEnd - 1) == ',')
        valueEnd--; 
      if (cookieBuilder == null) {
        DefaultCookie cookie = initCookie(header, nameBegin, nameEnd, valueBegin, valueEnd);
        if (cookie == null)
          return null; 
        cookieBuilder = new CookieBuilder(cookie, header);
        continue;
      } 
      cookieBuilder.appendAttribute(nameBegin, nameEnd, valueBegin, valueEnd);
    } 
    return (cookieBuilder != null) ? cookieBuilder.cookie() : null;
  }
}
